<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Design - lapillo</title>
    <link href="https://cdn.jsdelivr.net/npm/@shadcn/ui@latest/dist/tailwind.css" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="studio-lapillo.css">
    
    <!-- Firebase CDN -->
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-compat-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-compat-storage.js"></script>
    
    <!-- Firebase ì„¤ì • ë° ì»´í¬ë„ŒíŠ¸ ë¡œë” -->
    <script src="js/firebase-cdn.js"></script>
    <script src="js/component-loader.js"></script>
    <script src="js/navigation-manager.js"></script>
    <script src="js/mobile-menu.js"></script>
</head>
<body class="bg-white font-sans">
    <!-- Header Component Placeholder -->
    <div id="header"></div>

    <!-- Loading Screen -->
    <div id="loading" class="fixed inset-0 bg-white flex items-center justify-center z-50">
        <div class="text-center">
            <div class="inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-gray-900 mb-4"></div>
            <p class="text-gray-600">Design í¬íŠ¸í´ë¦¬ì˜¤ ë¡œë”© ì¤‘...</p>
        </div>
    </div>

    <!-- Main Content -->
    <main class="main-content">
        <div class="portfolio-container">
            <div class="portfolio-grid" id="gridThumbs">
                <!-- í¬íŠ¸í´ë¦¬ì˜¤ ì•„ì´í…œë“¤ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ì¶”ê°€ë©ë‹ˆë‹¤ -->
            </div>
        </div>
    </main>

    <!-- Footer Component Placeholder -->
    <div id="footer"></div>

    <!-- JavaScript -->
    <script>
        // ì»´í¬ë„ŒíŠ¸ì™€ ë°ì´í„° ë¡œë”© ê´€ë¦¬
        async function initializePage() {
            try {
                console.log('ğŸ¨ Design í˜ì´ì§€ ì´ˆê¸°í™” ì‹œì‘...');
                
                // 1. ì»´í¬ë„ŒíŠ¸ ë¡œë“œ
                await window.componentLoader.loadComponents();
                
                // 2. Firebase ì„œë¹„ìŠ¤ ëŒ€ê¸°
                let retryCount = 0;
                while (!window.firebaseService && retryCount < 10) {
                    console.log(`â³ Firebase ì„œë¹„ìŠ¤ ëŒ€ê¸° ì¤‘... (${retryCount + 1}/10)`);
                    await new Promise(resolve => setTimeout(resolve, 500));
                    retryCount++;
                }
                
                if (!window.firebaseService) {
                    throw new Error('Firebase ì„œë¹„ìŠ¤ë¥¼ ì´ˆê¸°í™”í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                }
                
                // 3. ëª¨ë°”ì¼ ë©”ë‰´ ì´ˆê¸°í™”
                initMobileMenu();
                
                // 4. ë„¤ë¹„ê²Œì´ì…˜ ì—…ë°ì´íŠ¸
                if (window.navigationManager) {
                    await window.navigationManager.updateNavigation();
                }
                
                // 5. Design í¬íŠ¸í´ë¦¬ì˜¤ ë¡œë“œ
                await loadDesignPortfolios();
                
                console.log('âœ… Design í˜ì´ì§€ ì´ˆê¸°í™” ì™„ë£Œ');
                
            } catch (error) {
                console.error('âŒ í˜ì´ì§€ ì´ˆê¸°í™” ì‹¤íŒ¨:', error);
                showError();
            }
        }

        // Design ì¹´í…Œê³ ë¦¬ í¬íŠ¸í´ë¦¬ì˜¤ ë¡œë“œ í•¨ìˆ˜
        async function loadDesignPortfolios() {
            try {
                console.log('ğŸ¨ Design í¬íŠ¸í´ë¦¬ì˜¤ ë¡œë”© ì‹œì‘...');
                
                // FirebaseServiceë¥¼ í†µí•œ í¬íŠ¸í´ë¦¬ì˜¤ ë¡œë“œ
                const allPortfolios = await window.firebaseService.getAllPortfolios();
                const designPortfolios = allPortfolios.filter(p => (p.category || 'design') === 'design');
                
                console.log('âœ… ë¡œë“œëœ Design í¬íŠ¸í´ë¦¬ì˜¤:', designPortfolios.length, 'ê°œ');
                
                // ë¡œë”© ìˆ¨ê¸°ê¸°
                const loadingElement = document.getElementById('loading');
                if (loadingElement) {
                    loadingElement.style.display = 'none';
                }
                
                // í¬íŠ¸í´ë¦¬ì˜¤ ë Œë”ë§
                renderPortfolios(designPortfolios);
                
            } catch (error) {
                console.error('âŒ Design í¬íŠ¸í´ë¦¬ì˜¤ ë¡œë“œ ì—ëŸ¬:', error);
                showError();
            }
        }

        // í¬íŠ¸í´ë¦¬ì˜¤ ë Œë”ë§
        function renderPortfolios(portfolios) {
            const gridContainer = document.getElementById('gridThumbs');
            if (!gridContainer) return;
            
            gridContainer.innerHTML = '';
            
            if (portfolios.length > 0) {
                portfolios.forEach(portfolio => {
                    const gridItem = document.createElement('a');
                    gridItem.className = 'grid-item';
                    gridItem.href = `portfolio-detail.html?id=${portfolio.id}`;
                    
                    gridItem.innerHTML = `
                        <div class="grid-image">
                            <div class="grid-image-inner-wrapper">
                                <img src="${portfolio.thumbnail || './img/placeholder.jpg'}" 
                                     alt="${portfolio.englishTitle || portfolio.title || 'Portfolio'}" 
                                     class="portfolio-image"
                                     onerror="this.src='./img/placeholder.jpg'">
                            </div>
                        </div>
                        <div class="portfolio-text">
                            <h3 class="portfolio-title">${portfolio.englishTitle || portfolio.title || 'Untitled'}</h3>
                        </div>
                    `;
                    
                    gridContainer.appendChild(gridItem);
                });
                console.log('âœ… Design í¬íŠ¸í´ë¦¬ì˜¤ ë Œë”ë§ ì™„ë£Œ');
            } else {
                gridContainer.innerHTML = `
                    <div class="col-span-full text-center py-12">
                        <p class="text-gray-500">Design ì¹´í…Œê³ ë¦¬ì— í¬íŠ¸í´ë¦¬ì˜¤ê°€ ì—†ìŠµë‹ˆë‹¤.</p>
                    </div>
                `;
                console.log('âš ï¸ Design í¬íŠ¸í´ë¦¬ì˜¤ ì—†ìŒ');
            }
        }

        // ì—ëŸ¬ ìƒíƒœ í‘œì‹œ
        function showError() {
            const loadingElement = document.getElementById('loading');
            if (loadingElement) {
                loadingElement.style.display = 'none';
            }
            
            const gridContainer = document.getElementById('gridThumbs');
            if (gridContainer) {
                gridContainer.innerHTML = `
                    <div class="text-center text-red-500 py-12">
                        <p>Design í¬íŠ¸í´ë¦¬ì˜¤ ë¡œë”©ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.</p>
                        <button onclick="location.reload()" class="mt-4 px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600">
                            ë‹¤ì‹œ ì‹œë„
                        </button>
                    </div>
                `;
            }
        }

        // ëª¨ë°”ì¼ ë©”ë‰´ ìƒíƒœ ê´€ë¦¬
        let mobileMenuOpen = false;

        // ë™ì  ë©”ë‰´ ìŠ¤íƒ€ì¼ ê³„ì‚°
        function calculateDynamicMenuStyles() {
            const header = document.querySelector('header');
            const viewportHeight = window.innerHeight;
            const viewportWidth = window.innerWidth;

            if (header) {
                const headerHeight = header.offsetHeight;
                document.documentElement.style.setProperty('--header-height', headerHeight + 'px');
            }

            const availableHeight = viewportHeight - (header ? header.offsetHeight : 80);
            
            // ë©”ë‰´ ê°„ê²© ê³„ì‚° (80%ë¡œ ì¤„ì„)
            const menuGap = Math.max(0.6, Math.min(1.2, availableHeight * 0.08 / 16 * 0.8));
            document.documentElement.style.setProperty('--menu-gap', menuGap + 'rem');
            
            // í°íŠ¸ í¬ê¸° ê³„ì‚° (í˜„ì¬ì˜ 90% â†’ ì¶”ê°€ 90% = 81%)
            const fontSize = Math.max(1.4, Math.min(2.2, viewportWidth * 0.045 * 0.81));
            document.documentElement.style.setProperty('--menu-font-size', fontSize + 'rem');
        }

        // ëª¨ë°”ì¼ ë©”ë‰´ í† ê¸€
        function toggleMobileMenu() {
            const mobileMenu = document.getElementById('mobile-menu');
            const hamburgerBtn = document.getElementById('hamburger-btn');
            
            if (!mobileMenu || !hamburgerBtn) {
                console.error('âŒ Elements not found');
                return;
            }
            
            mobileMenuOpen = !mobileMenuOpen;
            
            if (mobileMenuOpen) {
                // ë©”ë‰´ ì—´ê¸°
                calculateDynamicMenuStyles();
                mobileMenu.style.display = 'block';
                mobileMenu.classList.add('show');
                hamburgerBtn.classList.add('active');
                document.body.style.overflow = 'hidden';
                
                console.log('âœ… Mobile menu opened');
            } else {
                // ë©”ë‰´ ë‹«ê¸°
                mobileMenu.classList.remove('show');
                hamburgerBtn.classList.remove('active');
                document.body.style.overflow = 'auto';
                
                setTimeout(() => {
                    if (!mobileMenuOpen) {
                        mobileMenu.style.display = 'none';
                    }
                }, 300);
                
                console.log('âœ… Mobile menu closed');
            }
        }

        // ëª¨ë°”ì¼ ë©”ë‰´ ì´ˆê¸°í™”
        function initMobileMenu() {
            const hamburgerBtn = document.getElementById('hamburger-btn');
            const mobileMenu = document.getElementById('mobile-menu');
            
            if (hamburgerBtn) {
                hamburgerBtn.addEventListener('click', toggleMobileMenu);
                console.log('âœ… Hamburger button initialized');
            } else {
                console.error('âŒ Hamburger button not found');
            }

            if (mobileMenu) {
                console.log('âœ… Mobile menu found');
            } else {
                console.error('âŒ Mobile menu not found');
            }

            // ë©”ë‰´ ë§í¬ í´ë¦­ ì‹œ ë‹«ê¸°
            const mobileNav = document.getElementById('mobile-navigation');
            if (mobileNav) {
                mobileNav.addEventListener('click', (e) => {
                    if (e.target.tagName === 'A') {
                        toggleMobileMenu();
                    }
                });
            }

            // í™”ë©´ í¬ê¸° ë³€ê²½ ì‹œ ë™ì  ìŠ¤íƒ€ì¼ ì¬ê³„ì‚° ë° ëª¨ë°”ì¼ ë©”ë‰´ ìë™ ë‹«ê¸°
            window.addEventListener('resize', () => {
                if (mobileMenuOpen) {
                    // 768pxì„ ë„˜ì–´ê°€ë©´ ëª¨ë°”ì¼ ë©”ë‰´ ìë™ ë‹«ê¸°
                    if (window.innerWidth > 768) {
                        toggleMobileMenu();
                    } else {
                        calculateDynamicMenuStyles();
                    }
                }
            });
        }
        
        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
        setTimeout(() => {
            initializePage();
        }, 500);
    </script>
</body>
</html>
