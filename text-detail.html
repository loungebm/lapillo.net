<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title id="page-title">Text Only - lapillo</title>
    <link href="https://cdn.jsdelivr.net/npm/@shadcn/ui@latest/dist/tailwind.css" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="studio-lapillo.css">
    
    <!-- Firebase CDN -->
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-compat-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-compat-storage.js"></script>
    
    <!-- Firebase ì„¤ì • ë° ì»´í¬ë„ŒíŠ¸ ì‹œìŠ¤í…œ -->
    <script src="js/firebase-cdn.js"></script>
    <script src="js/component-loader.js"></script>
    <script src="js/navigation-manager.js"></script>
</head>
<body class="bg-white font-sans">
    <!-- Header Component Placeholder -->
    <div id="header-placeholder"></div>

    <!-- Text-Only Content Section -->
    <main class="py-6">
        <div class="project-detail-wrapper">
            <!-- Loading State -->
            <div id="loading" class="text-center py-12">
                <div class="inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-gray-900 mb-4"></div>
                <p class="text-gray-600">ë¡œë”© ì¤‘...</p>
            </div>

            <!-- Text-Only Content (Hidden until loaded) -->
            <div id="text-content" class="hidden">
                <!-- Text Section - 2 Columns (ì œëª© ì—†ìŒ) -->
                <div class="project-text-section">
                    <!-- Left Column -->
                    <div class="project-text-left">
                        <div class="project-description">
                            <div id="korean-content"></div>
                        </div>
                    </div>
                    
                    <!-- Right Column -->
                    <div class="project-text-right">
                        <div class="project-description">
                            <div id="english-content"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Error State -->
            <div id="error-state" class="text-center py-12 hidden">
                <div class="text-red-500 mb-4">
                    <svg class="w-12 h-12 mx-auto" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.732-.833-2.464 0L4.35 18.5c-.77.833.192 2.5 1.732 2.5z"></path>
                    </svg>
                </div>
                <p class="text-gray-600 mb-4">í˜ì´ì§€ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</p>
                <a href="index.html" class="inline-block px-4 py-2 bg-gray-900 text-white rounded hover:bg-gray-700 transition-colors">
                    í™ˆìœ¼ë¡œ ëŒì•„ê°€ê¸°
                </a>
            </div>
        </div>
    </main>

    <!-- Footer Component Placeholder -->
    <div id="footer-placeholder"></div>

    <script>
        // URLì—ì„œ ì¹´í…Œê³ ë¦¬ íŒŒë¼ë¯¸í„° ì¶”ì¶œ
        function getCategoryFromURL() {
            const urlParams = new URLSearchParams(window.location.search);
            return urlParams.get('category');
        }

        // Text-Only ì»¨í…ì¸  ë¡œë“œ
        async function loadTextContent() {
            try {
                const category = getCategoryFromURL();
                if (!category) {
                    throw new Error('ì¹´í…Œê³ ë¦¬ê°€ ì§€ì •ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.');
                }

                console.log('ğŸ“ Text-Only í˜ì´ì§€ ë¡œë”© ì‹œì‘ - ì¹´í…Œê³ ë¦¬:', category);

                // Firebase ì„œë¹„ìŠ¤ ëŒ€ê¸°
                let retryCount = 0;
                while (!window.firebaseService && retryCount < 10) {
                    console.log(`â³ Firebase ì„œë¹„ìŠ¤ ëŒ€ê¸° ì¤‘... (${retryCount + 1}/10)`);
                    await new Promise(resolve => setTimeout(resolve, 500));
                    retryCount++;
                }

                if (!window.firebaseService) {
                    throw new Error('Firebase ì„œë¹„ìŠ¤ë¥¼ ì´ˆê¸°í™”í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                }

                // í•´ë‹¹ ì¹´í…Œê³ ë¦¬ì˜ Text-Only í¬íŠ¸í´ë¦¬ì˜¤ ë¡œë“œ
                const portfolios = await window.firebaseService.getPortfoliosByCategory(category);
                const textOnlyPortfolios = portfolios.filter(p => p.textOnly);

                console.log('ğŸ“ ë¡œë“œëœ Text-Only í¬íŠ¸í´ë¦¬ì˜¤:', textOnlyPortfolios.length, 'ê°œ');

                if (textOnlyPortfolios.length === 0) {
                    throw new Error('í•´ë‹¹ ì¹´í…Œê³ ë¦¬ì˜ Text-Only ì»¨í…ì¸ ê°€ ì—†ìŠµë‹ˆë‹¤.');
                }

                // ì²« ë²ˆì§¸ (ìµœì‹ ) Text-Only í¬íŠ¸í´ë¦¬ì˜¤ ì‚¬ìš©
                const content = textOnlyPortfolios[0];
                
                // í˜ì´ì§€ ì œëª© ì„¤ì •
                const pageTitle = content.koreanTitle || content.englishTitle || content.title || 'Text Only';
                document.getElementById('page-title').textContent = `${pageTitle} - lapillo`;

                // ë‹¨ì¼ ë‚´ìš© ì‚¬ìš© (í•œ/ì˜ êµ¬ë¶„ ì—†ì´ ë™ì¼ ë‚´ìš© ì‚¬ìš©)
                const singleContent = content.description || content.koreanDescription || content.englishDescription || '';
                const koreanContent = singleContent;
                const koreanParagraphs = koreanContent.split('\n\n').map(p => `<p>${p}</p>`).join('');
                document.getElementById('korean-content').innerHTML = koreanParagraphs;

                // ìš°ì¸¡ ì»¬ëŸ¼ì—ë„ ë™ì¼ ë‚´ìš© ì‚¬ìš©
                const englishContent = singleContent;
                const englishParagraphs = englishContent.split('\n\n').map(p => `<p>${p}</p>`).join('');
                document.getElementById('english-content').innerHTML = englishParagraphs;

                // ë¡œë”© ìˆ¨ê¸°ê³  ì»¨í…ì¸  í‘œì‹œ
                document.getElementById('loading').classList.add('hidden');
                document.getElementById('text-content').classList.remove('hidden');

                console.log('âœ… Text-Only ì»¨í…ì¸  ë¡œë”© ì™„ë£Œ');

            } catch (error) {
                console.error('âŒ Text-Only ì»¨í…ì¸  ë¡œë“œ ì—ëŸ¬:', error);
                
                // ë¡œë”© ìˆ¨ê¸°ê³  ì—ëŸ¬ ìƒíƒœ í‘œì‹œ
                document.getElementById('loading').classList.add('hidden');
                document.getElementById('error-state').classList.remove('hidden');
            }
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
        document.addEventListener('DOMContentLoaded', async () => {
            console.log('ğŸ“ Text-Only í˜ì´ì§€ ì´ˆê¸°í™” ì‹œì‘...');

            // ì»´í¬ë„ŒíŠ¸ ë¡œë”©
            console.log('ğŸ”„ ì»´í¬ë„ŒíŠ¸ ë¡œë”© ì‹œì‘...');
            await loadComponent('header-placeholder', 'components/header.html');
            await loadComponent('footer-placeholder', 'components/footer.html');
            console.log('âœ… ì»´í¬ë„ŒíŠ¸ ë¡œë”© ì™„ë£Œ');

            // NavigationManager ì´ˆê¸°í™” ë° ì—…ë°ì´íŠ¸
            if (window.navigationManager) {
                const category = getCategoryFromURL();
                window.navigationManager.currentPage = category; // í˜„ì¬ í˜ì´ì§€ ì„¤ì •
                await window.navigationManager.updateNavigation();
                
                // Text-Only í˜ì´ì§€ì—ì„œëŠ” í•´ë‹¹ ì¹´í…Œê³ ë¦¬ ë©”ë‰´ë¥¼ í™œì„±í™”
                if (category) {
                    window.navigationManager.setActiveMenu(category);
                }
                console.log('âœ… ë„¤ë¹„ê²Œì´ì…˜ ì—…ë°ì´íŠ¸ ì™„ë£Œ');
            } else {
                console.warn('âš ï¸ NavigationManagerê°€ ì—†ìŠµë‹ˆë‹¤');
            }

            // Text-Only ì»¨í…ì¸  ë¡œë“œ
            await loadTextContent();
            
            console.log('âœ… Text-Only í˜ì´ì§€ ì´ˆê¸°í™” ì™„ë£Œ');
        });
    </script>
</body>
</html>
