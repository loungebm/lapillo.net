<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Design - lapillo</title>
    <link href="https://cdn.jsdelivr.net/npm/@shadcn/ui@latest/dist/tailwind.css" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="studio-lapillo.css">
    
    <!-- Firebase CDN -->
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-compat-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-compat-storage.js"></script>
    
    <!-- Firebase μ„¤μ • λ° μ»΄ν¬λ„νΈ λ΅λ” -->
    <script src="js/firebase-cdn.js"></script>
    <script src="js/component-loader.js"></script>
    <script src="js/navigation-manager.js"></script>
</head>
<body class="bg-white font-sans">
    <!-- Header Component Placeholder -->
    <div id="header"></div>

    <!-- Loading Screen -->
    <div id="loading" class="fixed inset-0 bg-white flex items-center justify-center z-50">
        <div class="text-center">
            <div class="inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-gray-900 mb-4"></div>
            <p class="text-gray-600">Design ν¬νΈν΄λ¦¬μ¤ λ΅λ”© μ¤‘...</p>
        </div>
    </div>

    <!-- Main Content -->
    <main class="main-content">
        <div class="portfolio-container">
            <div class="portfolio-grid" id="gridThumbs">
                <!-- ν¬νΈν΄λ¦¬μ¤ μ•„μ΄ν…λ“¤μ΄ μ—¬κΈ°μ— λ™μ μΌλ΅ μ¶”κ°€λ©λ‹λ‹¤ -->
            </div>
        </div>
    </main>

    <!-- Footer Component Placeholder -->
    <div id="footer"></div>

    <!-- JavaScript -->
    <script>
        // μ»΄ν¬λ„νΈμ™€ λ°μ΄ν„° λ΅λ”© κ΄€λ¦¬
        async function initializePage() {
            try {
                console.log('π¨ Design νμ΄μ§€ μ΄κΈ°ν™” μ‹μ‘...');
                
                // 1. μ»΄ν¬λ„νΈ λ΅λ“
                await window.componentLoader.loadComponents();
                
                // 2. Firebase μ„λΉ„μ¤ λ€κΈ°
                let retryCount = 0;
                while (!window.firebaseService && retryCount < 10) {
                    console.log(`β³ Firebase μ„λΉ„μ¤ λ€κΈ° μ¤‘... (${retryCount + 1}/10)`);
                    await new Promise(resolve => setTimeout(resolve, 500));
                    retryCount++;
                }
                
                if (!window.firebaseService) {
                    throw new Error('Firebase μ„λΉ„μ¤λ¥Ό μ΄κΈ°ν™”ν•  μ μ—†μµλ‹λ‹¤.');
                }
                
                // 3. λ„¤λΉ„κ²μ΄μ… μ—…λ°μ΄νΈ
                if (window.navigationManager) {
                    await window.navigationManager.updateNavigation();
                }
                
                // 4. Design ν¬νΈν΄λ¦¬μ¤ λ΅λ“
                await loadDesignPortfolios();
                
                console.log('β… Design νμ΄μ§€ μ΄κΈ°ν™” μ™„λ£');
                
            } catch (error) {
                console.error('β νμ΄μ§€ μ΄κΈ°ν™” μ‹¤ν¨:', error);
                showError();
            }
        }

        // Design μΉ΄ν…κ³ λ¦¬ ν¬νΈν΄λ¦¬μ¤ λ΅λ“ ν•¨μ
        async function loadDesignPortfolios() {
            try {
                console.log('π¨ Design ν¬νΈν΄λ¦¬μ¤ λ΅λ”© μ‹μ‘...');
                
                // FirebaseServiceλ¥Ό ν†µν• ν¬νΈν΄λ¦¬μ¤ λ΅λ“
                const allPortfolios = await window.firebaseService.getAllPortfolios();
                const designPortfolios = allPortfolios.filter(p => (p.category || 'design') === 'design');
                
                console.log('β… λ΅λ“λ Design ν¬νΈν΄λ¦¬μ¤:', designPortfolios.length, 'κ°');
                
                // λ΅λ”© μ¨κΈ°κΈ°
                const loadingElement = document.getElementById('loading');
                if (loadingElement) {
                    loadingElement.style.display = 'none';
                }
                
                // ν¬νΈν΄λ¦¬μ¤ λ λ”λ§
                renderPortfolios(designPortfolios);
                
            } catch (error) {
                console.error('β Design ν¬νΈν΄λ¦¬μ¤ λ΅λ“ μ—λ¬:', error);
                showError();
            }
        }

        // ν¬νΈν΄λ¦¬μ¤ λ λ”λ§
        function renderPortfolios(portfolios) {
            const gridContainer = document.getElementById('gridThumbs');
            if (!gridContainer) return;
            
            gridContainer.innerHTML = '';
            
            if (portfolios.length > 0) {
                portfolios.forEach(portfolio => {
                    const gridItem = document.createElement('a');
                    gridItem.className = 'grid-item';
                    gridItem.href = `portfolio-detail.html?id=${portfolio.id}`;
                    
                    gridItem.innerHTML = `
                        <div class="grid-image">
                            <div class="grid-image-inner-wrapper">
                                <img src="${portfolio.thumbnail || './img/placeholder.jpg'}" 
                                     alt="${portfolio.englishTitle || portfolio.title || 'Portfolio'}" 
                                     class="portfolio-image"
                                     onerror="this.src='./img/placeholder.jpg'">
                            </div>
                        </div>
                        <div class="portfolio-text">
                            <h3 class="portfolio-title">${portfolio.englishTitle || portfolio.title || 'Untitled'}</h3>
                        </div>
                    `;
                    
                    gridContainer.appendChild(gridItem);
                });
                console.log('β… Design ν¬νΈν΄λ¦¬μ¤ λ λ”λ§ μ™„λ£');
            } else {
                gridContainer.innerHTML = `
                    <div class="col-span-full text-center py-12">
                        <p class="text-gray-500">Design μΉ΄ν…κ³ λ¦¬μ— ν¬νΈν΄λ¦¬μ¤κ°€ μ—†μµλ‹λ‹¤.</p>
                    </div>
                `;
                console.log('β οΈ Design ν¬νΈν΄λ¦¬μ¤ μ—†μ');
            }
        }

        // μ—λ¬ μƒνƒ ν‘μ‹
        function showError() {
            const loadingElement = document.getElementById('loading');
            if (loadingElement) {
                loadingElement.style.display = 'none';
            }
            
            const gridContainer = document.getElementById('gridThumbs');
            if (gridContainer) {
                gridContainer.innerHTML = `
                    <div class="text-center text-red-500 py-12">
                        <p>Design ν¬νΈν΄λ¦¬μ¤ λ΅λ”©μ— μ‹¤ν¨ν–μµλ‹λ‹¤.</p>
                        <button onclick="location.reload()" class="mt-4 px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600">
                            λ‹¤μ‹ μ‹λ„
                        </button>
                    </div>
                `;
            }
        }
        
        // νμ΄μ§€ λ΅λ“ μ‹ μ΄κΈ°ν™”
        setTimeout(() => {
            initializePage();
        }, 500);
    </script>
</body>
</html>
